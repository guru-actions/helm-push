---
apiVersion: automation.cloudbees.io/v1alpha1
kind: action
name: deploy helm chart
description: deploys a helm chart using a standard repo
inputs:
  chart:
    description: chart name
    required: true
  remote:
    description: remote chart repository
    required: true
  remote_user_name:
    description: user name for the remote repo
    required: false
  remote_password:
    description: cred for te remote password
    required: false
  
runs:
  using: composite
  steps:
    - id: deploy_chart
      name: Deploy Chart
      uses: docker://alpine/helm:latest
      shell: sh
      run: |
      
         _auth=""
         if [ "${{ inputs.remote_user_name }}" != "" ] && [ "${{ inputs.remote_password }}" != "" ]; then
           _auth="--username=${{ inputs.remote_user_name }} --password=${{ inputs.remote_password }}"
           printf "setting authentiation for helm repo as user name and credential provided\n"
         fi
         
         helm repo add ${{ inputs.remote }} ${{ inputs.chart }} $_auth
         
         helm repo push ${{ inputs.chart }} ${{ inputs.remote }}
         
         
